---
title: "sub_table_SW"
author: "Thomas A."
date: "30/06/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(ggpubr)
library(car)
library(haven)
library(data.table)
library(visreg)
library(dplyr)
library(tidyr)
library(reshape2)
library(rstatix)
library(JWileymisc)
library(lme4)
#library(lmerTest)
#library(multilevelTools)
library(tidyverse)
library(mediation)


SWS_data <- read.table("../Tables/CTET_SWdetection_thr90_byE_P2P_avDens_behav_vec_full_v3_CLUSTERS.txt", header = TRUE, sep = ",", stringsAsFactors = FALSE)

names(SWS_data)[names(SWS_data) == "Drug"] <- "Treatment"

SWS_data$Treatment<-as.factor(SWS_data$Treatment)

SWS_data$Treatment<-relevel(SWS_data$Treatment,"PLA")

nsims<-10000

```



```{r}
#detach("package:multilevelTools", unload=TRUE)
#detach("package:lmerTest", unload=TRUE)

SWS_data3<-SWS_data[SWS_data$Treatment=="PLA" | SWS_data$Treatment=="MPH",] #|: . $: and
SWS_data3<-SWS_data3[is.na(SWS_data3$Hit_RT)==FALSE,]
SWS_data3$Treatment<-droplevels(SWS_data3$Treatment)

### Neg MPH on RT
med.fit1 <- lmer(C_Neg_MPH  ~ 1 + Treatment + (1|SubID), data = SWS_data3)
med.fit2 <- lmer(Hit_RT  ~ 1 + C_Neg_MPH + (1|SubID), data = SWS_data3)
out.fit1 <- lmer(Hit_RT  ~ 1 + C_Neg_MPH * Treatment + (1|SubID), data = SWS_data3)
med.out1 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_MPH",boot = FALSE, sims = nsims, group.out='SubID')
print(' MPH - Hit RT (Negative MPH cluster)')
summary(med.out1)

## Neg MPH on misses 
med.fit1 <- lmer(C_Neg_MPH  ~ 1 + Treatment + (1|SubID), data = SWS_data3)
out.fit1 <- lmer(Miss  ~ 1 + C_Neg_MPH * Treatment + (1|SubID), data = SWS_data3)
med.out2 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_MPH",robustSE = TRUE, sims = nsims)
print(' MPH - Miss (Negative MPH cluster)')
summary(med.out2)

## Neg MPH on FA
med.fit1 <- lmer(C_Neg_MPH  ~ 1 + Treatment + (1|SubID), data = SWS_data3)
out.fit1 <- lmer(FA  ~ 1 + C_Neg_MPH * Treatment + (1|SubID), data = SWS_data3)
med.out3 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_MPH",robustSE = TRUE, sims = nsims)
print(' MPH - FA (Negative MPH cluster)')
summary(med.out3)

### bmlm package
#library("bmlm")
#fit<-mlm(d=SWS_data3,id="SubID",x="Treatment",m="C_Neg_MPH",y="Hit_RT",iter=nsims,core=2)
```
NEG MPH ON RT: 
  - significant direct path for both control and treatment (p <.001) and total effect (p < .001)
  -non-significant mediated path 
  -significant average ADE (p <.001)
  
NEG MPH ON Misses: 
  - Significant direct path for treated and control (p < .001) and total effect (p <.001)
  -significant average ADE (p < .001)
  -non-significant mediated path 
NEG MPH ON FA: 
  - mediated path for control (p = .0228) and treated (p <.0018) are significant
  - non-significant direct path 
  - ACME average is significant (p < .001)



```{r}
SWS_data4<-SWS_data[SWS_data$Treatment=="PLA" | SWS_data$Treatment=="ATM",] 
SWS_data4<-SWS_data4[is.na(SWS_data4$Hit_RT)==FALSE,]
SWS_data4$Treatment<-droplevels(SWS_data4$Treatment)

### Neg ATM on RT
med.fit1 <- lmer(C_Neg_ATM  ~ 1 + Treatment + (1|SubID), data = SWS_data4)
out.fit1 <- lmer(Hit_RT  ~ 1 + C_Neg_ATM * Treatment + (1|SubID), data = SWS_data4)
med.out4 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_ATM",robustSE = TRUE, sims = nsims)
print(' ATM - Hit RT (Negative ATM cluster)')
summary(med.out4)

## Neg ATM on misses 
med.fit1 <- lmer(C_Neg_ATM  ~ 1 + Treatment + (1|SubID), data = SWS_data4)
out.fit1 <- lmer(Miss  ~ 1 + C_Neg_ATM * Treatment + (1|SubID), data = SWS_data4)
med.out5 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_ATM",robustSE = TRUE, sims = nsims)
print(' ATM - Miss (Negative ATM cluster)')
summary(med.out5)

## Neg ATM on FA
med.fit1 <- lmer(C_Neg_ATM  ~ 1 + Treatment + (1|SubID), data = SWS_data4)
out.fit1 <- lmer(FA  ~ 1 + C_Neg_ATM * Treatment + (1|SubID), data = SWS_data4)
med.out6 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_ATM",robustSE = TRUE, sims = nsims)
print(' ATM - FA (Negative ATM cluster)')
summary(med.out6)
#fit<-mlmer(d=SWS_data4,id="SubID",x="Treatment",m="C_Neg_ATM",y="Miss",iter=1000,core=2)
```
NEG ATM ON RT: 
  - significant direct effect for control (p = .019) and treated (p = .032) and total effect (p = .024)
  - non-significant mediated path 
  - ADE average was significant (p = .025)
  
NEG ATM ON Misses: 
  -non-significant effect for all 
NEG ATM ON FA:
  - non-significant effect for all 

```{r}
### Pos ATM on RT
med.fit1 <- lmer(C_Pos_ATM  ~ 1 + Treatment + (1|SubID), data = SWS_data4)
out.fit1 <- lmer(Hit_RT  ~ 1 + C_Pos_ATM * Treatment + (1|SubID), data = SWS_data4)
med.out7 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_ATM",robustSE = TRUE, sims = nsims)
print(' ATM - Hit RT (Positive ATM cluster)')
summary(med.out7)

## Pos ATM on misses 
med.fit1 <- lmer(C_Pos_ATM  ~ 1 + Treatment + (1|SubID), data = SWS_data4)
out.fit1 <- lmer(Miss  ~ 1 + C_Pos_ATM * Treatment + (1|SubID), data = SWS_data4)
med.out8 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_ATM",robustSE = TRUE, sims = nsims)
print(' ATM - Miss (Positive ATM cluster)')
summary(med.out8)

## Pos ATM on FA
med.fit1 <- lmer(C_Pos_ATM  ~ 1 + Treatment + (1|SubID), data = SWS_data4)
out.fit1 <- lmer(FA  ~ 1 + C_Pos_ATM * Treatment + (1|SubID), data = SWS_data4)
med.out9 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_ATM",robustSE = TRUE, sims = nsims)
print(' ATM - FA (Positive ATM cluster)')
summary(med.out9)


```

POS ATM ON RT: 
  - Significant direct path for control (p = .028) and treated (p = .025) and total effect (p = .021)
  - non-significant mediated path 
  -Significant ADE average (p = .023)
  
POS ATM ON Misses: 
  -Non-significant mediated path, direct path and total effect
  -Significant ACME (Average) effect (p = .043)
  
POS ATM ON FA: 
  -Non-signficant effects for everything

```{r}
SWS_data5<-SWS_data[SWS_data$Treatment=="PLA" | SWS_data$Treatment=="CIT",] 
SWS_data5<-SWS_data5[is.na(SWS_data5$Hit_RT)==FALSE,]
SWS_data5$Treatment<-droplevels(SWS_data5$Treatment)


### Pos CIT on RT
med.fit1 <- lmer(C_Pos_CIT  ~ 1 + Treatment + (1|SubID), data = SWS_data5)
out.fit1 <- lmer(Hit_RT  ~ 1 + C_Pos_CIT * Treatment + (1|SubID), data = SWS_data5)
med.out10 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_CIT",robustSE = TRUE, sims = nsims)
print(' CIT - Hit RT (Positive CIT cluster)')
summary(med.out10)

## Pos CIT on misses 
med.fit1 <- lmer(C_Pos_CIT  ~ 1 + Treatment + (1|SubID), data = SWS_data5)
out.fit1 <- lmer(Miss  ~ 1 + C_Pos_CIT * Treatment + (1|SubID), data = SWS_data5)
med.out11 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_CIT",robustSE = TRUE, sims = nsims)
print(' CIT - Miss (Positive CIT cluster)')
summary(med.out11)

## Pos CIT on FA
med.fit1 <- lmer(C_Pos_CIT  ~ 1 + Treatment + (1|SubID), data = SWS_data5)
out.fit1 <- lmer(FA  ~ 1 + C_Pos_CIT * Treatment + (1|SubID), data = SWS_data5)
med.out12 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_CIT",robustSE = TRUE, sims = nsims)
print(' CIT - FA (Positive CIT cluster)')
summary(med.out12)


```
POS CIT ON RT: 
  - Significant mediated path for treated (p < .01) and total effect (p = .0248)
  -Non-significant direct path 
  -significant prop. mediated effect for treated (p = .0316)
  -significant ACME average (p = .0322)
  
POS CIT ON Misses: 
  -significant mediated path for control (p < .001) and treated (p < .001)
  -significant direct path for control ( p < .001) and treated (p <.01)
  -significant total effect (p <.001)
  -Prop mediated control (p < .001) and prop mediated treated (p <.01)
  -Signficant ACME average (p < .001)
  -Significant ADE average (p < .001)
  -Prop. mediated average (p <.001)
  
POS CIT ON FA: 
  -non-significant effects for all

```{r}



```
