---
title: "sub_table_SW"
author: "Thomas A."
date: "30/06/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(ggpubr)
library(car)
library(haven)
library(data.table)
library(visreg)
library(dplyr)
library(tidyr)
library(reshape2)
library(rstatix)
library(JWileymisc)
library(lme4)
library(lmerTest)
library(multilevelTools)
library(tidyverse)
library(mediation)


SWS_data <- read.table("../Tables/CTET_SWdetection_thr90_byE_P2P_avDens_behav_vec_full_v3_CLUSTERS.txt", header = TRUE, sep = ",", stringsAsFactors = FALSE)

names(SWS_data)[names(SWS_data) == "Drug"] <- "Treatment"

SWS_data$Treatment<-as.factor(SWS_data$Treatment)

SWS_data$Treatment<-relevel(SWS_data$Treatment,"PLA")



```



```{r}
#detach("package:multilevelTools", unload=TRUE)
#detach("package:lmerTest", unload=TRUE)

SWS_data3<-SWS_data[SWS_data$Treatment=="PLA" | SWS_data$Treatment=="MPH",] #|: . $: and
SWS_data3<-SWS_data3[is.na(SWS_data3$Hit_RT)==FALSE,]
SWS_data3$Treatment<-droplevels(SWS_data3$Treatment)

### Neg MPH on RT
med.fit1 <- lm(C_Neg_MPH  ~ 1 + Treatment, data = SWS_data3)
out.fit1 <- lm(Hit_RT  ~ 1 + C_Neg_MPH * Treatment, data = SWS_data3)
med.out1 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_MPH",boot = TRUE, sims = 10000)
print(' MPH - Hit RT (Negative MPH cluster)')
summary(med.out1)

## Neg MPH on misses 
med.fit1 <- lm(C_Neg_MPH  ~ 1 + Treatment, data = SWS_data3)
out.fit1 <- lm(Miss  ~ 1 + C_Neg_MPH * Treatment, data = SWS_data3)
med.out2 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_MPH",robustSE = TRUE, sims = 10000)
print(' MPH - Miss (Negative MPH cluster)')
summary(med.out2)

## Neg MPH on FA
med.fit1 <- lm(C_Neg_MPH  ~ 1 + Treatment, data = SWS_data3)
out.fit1 <- lm(FA  ~ 1 + C_Neg_MPH * Treatment, data = SWS_data3)
med.out3 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_MPH",robustSE = TRUE, sims = 10000)
print(' MPH - FA (Negative MPH cluster)')
summary(med.out3)

### bmlm package
#library("bmlm")
#fit<-mlm(d=SWS_data3,id="SubID",x="Treatment",m="C_Neg_MPH",y="Hit_RT",iter=10000,core=2)
```
NEG MPH ON RT: 
  - significant direct path and total effect (p < .001)
  -non-significant mediated path 
NEG MPH ON Misses: 
  - Significant mediated path, direct path and total effect (p <.001)
NEG MPH ON FA: 
  - non-significxant results for everything 


```{r}
SWS_data4<-SWS_data[SWS_data$Treatment=="PLA" | SWS_data$Treatment=="ATM",] 
SWS_data4<-SWS_data4[is.na(SWS_data4$Hit_RT)==FALSE,]
SWS_data4$Treatment<-droplevels(SWS_data4$Treatment)

### Neg ATM on RT
med.fit1 <- lm(C_Neg_ATM  ~ 1 + Treatment, data = SWS_data4)
out.fit1 <- lm(Hit_RT  ~ 1 + C_Neg_ATM * Treatment, data = SWS_data4)
med.out4 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_ATM",robustSE = TRUE, sims = 10000)
print(' ATM - Hit RT (Negative ATM cluster)')
summary(med.out4)

## Neg ATM on misses 
med.fit1 <- lm(C_Neg_ATM  ~ 1 + Treatment, data = SWS_data4)
out.fit1 <- lm(Miss  ~ 1 + C_Neg_ATM * Treatment, data = SWS_data4)
med.out5 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_ATM",robustSE = TRUE, sims = 10000)
print(' ATM - Miss (Negative ATM cluster)')
summary(med.out5)

## Neg ATM on FA
med.fit1 <- lm(C_Neg_ATM  ~ 1 + Treatment, data = SWS_data4)
out.fit1 <- lm(FA  ~ 1 + C_Neg_ATM * Treatment, data = SWS_data4)
med.out6 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Neg_ATM",robustSE = TRUE, sims = 10000)
print(' ATM - FA (Negative ATM cluster)')
summary(med.out6)
#fit<-mlm(d=SWS_data4,id="SubID",x="Treatment",m="C_Neg_ATM",y="Miss",iter=1000,core=2)



### Pos ATM on RT
med.fit1 <- lm(C_Pos_ATM  ~ 1 + Treatment, data = SWS_data4)
out.fit1 <- lm(Hit_RT  ~ 1 + C_Pos_ATM * Treatment, data = SWS_data4)
med.out7 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_ATM",robustSE = TRUE, sims = 10000)
print(' ATM - Hit RT (Positive ATM cluster)')
summary(med.out7)

## Pos ATM on misses 
med.fit1 <- lm(C_Pos_ATM  ~ 1 + Treatment, data = SWS_data4)
out.fit1 <- lm(Miss  ~ 1 + C_Pos_ATM * Treatment, data = SWS_data4)
med.out8 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_ATM",robustSE = TRUE, sims = 10000)
print(' ATM - Miss (Positive ATM cluster)')
summary(med.out8)

## Pos ATM on FA
med.fit1 <- lm(C_Pos_ATM  ~ 1 + Treatment, data = SWS_data4)
out.fit1 <- lm(FA  ~ 1 + C_Pos_ATM * Treatment, data = SWS_data4)
med.out9 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_ATM",robustSE = TRUE, sims = 10000)
print(' ATM - FA (Positive ATM cluster)')
summary(med.out9)


```
NEG ATM ON RT: 
  - significant direct (p = .02) and total effect (p = .04)
  - non-significant mediated path 
NEG ATM ON Misses: 
  -Significant mediated path (p = .04)
  -non-significant direct path and total effect 
NEG ATM ON FA:
  - Significant mediated path (p < .001)
  -non-significant direct path and total effect 

POS ATM ON RT: 
  - Significant direct path (p = .02) and total effect (p < .001)
  - non-significant mediated path 
POS ATM ON Misses: 
  -Significant mediated path effect (p <.001)
  -Non-significant direct path and total effect
POS ATM ON FA: 
  - Significant mediated path (p < .001)
  -Non-signficant direct path and total effect

```{r}
SWS_data5<-SWS_data[SWS_data$Treatment=="PLA" | SWS_data$Treatment=="CIT",] 
SWS_data5<-SWS_data5[is.na(SWS_data5$Hit_RT)==FALSE,]
SWS_data5$Treatment<-droplevels(SWS_data5$Treatment)


### Pos CIT on RT
med.fit1 <- lm(C_Pos_CIT  ~ 1 + Treatment, data = SWS_data5)
out.fit1 <- lm(Hit_RT  ~ 1 + C_Pos_CIT * Treatment, data = SWS_data5)
med.out10 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_CIT",robustSE = TRUE, sims = 10000)
print(' CIT - Hit RT (Positive ATM cluster)')
summary(med.out10)

## Pos CIT on misses 
med.fit1 <- lm(C_Pos_CIT  ~ 1 + Treatment, data = SWS_data5)
out.fit1 <- lm(Miss  ~ 1 + C_Pos_CIT * Treatment, data = SWS_data5)
med.out11 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_CIT",robustSE = TRUE, sims = 10000)
print(' CIT - Miss (Positive ATM cluster)')
summary(med.out11)

## Pos CIT on FA
med.fit1 <- lm(C_Pos_CIT  ~ 1 + Treatment, data = SWS_data5)
out.fit1 <- lm(FA  ~ 1 + C_Pos_CIT * Treatment, data = SWS_data5)
med.out12 <- mediate(med.fit1, out.fit1, treat = "Treatment", mediator = "C_Pos_CIT",robustSE = TRUE, sims = 10000)
print(' CIT - FA (Positive ATM cluster)')
summary(med.out12)


```
POS CIT ON RT: 
  - Significant mediated path (p < .001)
  -Non-significant direct path and total effect 
POS CIT ON Misses: 
  -non-significant mediated path 
  -significxant direct path and total effect (both p <.001)
POS CIGT ON FA: 
  -non-significant effects for all
  -non-significant effects for all 
