---
title: "sub_table_SW"
author: "Thomas A."
date: "30/06/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(ggpubr)
library(car)
library(haven)
library(data.table)
library(visreg)
library(dplyr)
library(tidyr)
library(reshape2)
library(rstatix)
library(JWileymisc)
library(lme4)
library(lmerTest)
library(multilevelTools)
library(tidyverse)
library(Rmisc)

SWS_data_perElec <- read.table("../Tables/CTET_SWdetection_thr90_allE_P2P_behav_vec.txt", header = TRUE, sep = ",", stringsAsFactors = FALSE)

#SWS_data <- read.table("../Tables/CTET_SWdetection_avDens_behav_vec.txt", header = TRUE, sep = ",", stringsAsFactors = FALSE)

SWS_data<-SWS_data_perElec[SWS_data_perElec$Elec=='Fpz',]

names(SWS_data)[names(SWS_data) == "Drug"] <- "Treatment"

SWS_data$Treatment<-as.factor(SWS_data$Treatment)

SWS_data$Treatment<-relevel(SWS_data$Treatment,"PLA")
```
```{r}
#detach("package:multilevelTools", unload=TRUE)
#detach("package:lmerTest", unload=TRUE)

lm.FA0 <- lmer(FA ~ 1 + (1|SubID), data = SWS_data, REML = FALSE)

##Effects of treatment on false alarms 
lm.FA1 <- lmer(FA ~ 1 + Treatment + (1|SubID), data = SWS_data, REML = FALSE)

#Added effects of block number on false alarm
lm.FA2 <- lmer(FA ~ 1 + Treatment + BlockN + (1|SubID), data = SWS_data, REML = FALSE)

#Added effects of slow wave density on false alarm on the winning model
lm.FA3 <- lmer(FA ~ 1 + Treatment + BlockN + SWdens + (1|SubID), data = SWS_data, REML = FALSE)

#Effects of just slow wave density and block number on false alarm
lm.FA4 <- lmer(FA ~ 1 + BlockN + SWdens + (1|SubID), data = SWS_data, REML = FALSE)

##Anova to see which one has the most interaction
anova(lm.FA0,lm.FA1,lm.FA2,lm.FA3)

```

```{r}
#detach("package:multilevelTools", unload=TRUE)
#detach("package:lmerTest", unload=TRUE)

##Misses 
lm.Miss0 <- lmer(Miss ~ 1 + (1|SubID), data = SWS_data, REML = FALSE)

##Effects of treatment on misses 
lm.Miss1 <- lmer(Miss ~ 1 + Treatment + (1|SubID), data = SWS_data, REML = FALSE)

#Added effects of block number on misses
lm.Miss2 <- lmer(Miss ~ 1 + Treatment + BlockN + (1|SubID), data = SWS_data, REML = FALSE)

##Added effects of block number as an interaction on misses 
lm.Miss3 <- lmer(Miss ~ 1 + Treatment + BlockN + SWdens + (1|SubID), data = SWS_data, REML = FALSE)

##Added effects of slow wave density on misses on the winning model
lm.Miss4 <- lmer(Miss ~ 1 + Treatment*BlockN + SWdens + (1|SubID), data = SWS_data, REML = FALSE)

##Effects of just slow wave density and block number on misses
lm.Miss5 <- lmer(Miss ~ 1  + BlockN + SWdens + (1|SubID), data = SWS_data, REML = FALSE)

##Anova to see which one has the most interaction
anova(lm.Miss0,lm.Miss1,lm.Miss2,lm.Miss3)

```

```{r}
##Hit Rate  
lm.HR0 <- lmer(Hit_RT ~ 1 + (1|SubID), data = SWS_data, REML = FALSE)

##Effects of treatment on hit rate 
lm.HR1 <- lmer(Hit_RT ~ 1 + Treatment + (1|SubID), data = SWS_data, REML = FALSE)

##Added effects of block number on hit rate  
lm.HR2 <- lmer(Hit_RT ~ 1 + Treatment + BlockN + (1|SubID), data = SWS_data, REML = FALSE)

##Added effects of block number as an interaction on hit rate  
lm.HR3 <- lmer(Hit_RT ~ 1 + Treatment + BlockN + SWdens + (1|SubID), data = SWS_data, REML = FALSE)

##Added effects of slow wave density on hit rate on the winning model
lm.HR4 <- lmer(Hit_RT ~ 1 + Treatment + SWdens + (1|SubID), data = SWS_data, REML = FALSE)

##Effects of just slow wave density and block number on hit rate
lm.HR5 <- lmer(Hit_RT ~ 1  + BlockN + SWdens + (1|SubID), data = SWS_data, REML = FALSE)


##Anova to see which one has the most interaction
anova(lm.HR0,lm.HR1,lm.HR2,lm.HR3)

```


```{r}
SWS_data$Treatment<-ordered(SWS_data$Treatment, c("PLA","MPH","ATM","CIT"))

#aggdata.fa <- aggregate(SWS_data[, 2], list( Treatment = SWS_data$Treatment, FA = SWS_data$FA, SWdens = SWS_data$SWdens), mean)
#colnames(aggdata.fa) = c("Treatment","FA", "SWdens","SubID")
SWS_data$Elec<-0
agg_SWS_data<-aggregate(. ~ SubID+Treatment, data = SWS_data, FUN = mean)

##Scatterplot of slow wave density and false alarm 
ggplot(agg_SWS_data, aes (x = SWdens, y = FA)) + geom_point(alpha = .5)+ geom_smooth(method=lm, se = FALSE)+ scale_colour_manual(values = c("#666666", "#d95f02", "#7570b3", "#1b9e77"))
cor.test(agg_SWS_data$SWdens, agg_SWS_data$FA)

##Scatterplot of slow wave density and misses
ggplot(agg_SWS_data, aes (x = SWdens, y = Miss)) + geom_point(alpha = .7)+ geom_smooth(method=lm, se = FALSE) + scale_colour_manual(values = c("#666666", "#d95f02", "#7570b3", "#1b9e77"))
cor.test(agg_SWS_data$SWdens, agg_SWS_data$Miss)

##Scatterplot of slow wave density and hit rate
ggplot(agg_SWS_data, aes (x = SWdens, y = Hit_RT)) + geom_point(alpha = .5)+ geom_smooth(method=lm, se = FALSE) + scale_colour_manual(values = c("#666666", "#d95f02", "#7570b3", "#1b9e77"))
cor.test(agg_SWS_data$SWdens, agg_SWS_data$Hit_RT)

```
